// Sass.
@use 'sass:list';
@use 'sass:map';

// Functions.
@use '../pick/pick.pattern.function' as pick-pattern;

// Status: DONE
// The `map.keys-pattern()` function retrieves keys of `$key-pattern` and `$keys-pattern` with pattern.
// @param `$map` A map to retrieve `$key-pattern` or `$keys-pattern`.
// @param `$key-pattern` Required key with pattern where '?=' is list.index, '*' is substring, '^' is start, and '$' is end of `string`.
// @arbitrary `$keys-pattern...` Additional keys with pattern to retrieve from `$map`.
// @returns The returned value is a list of keys with pattern.
@function pattern($map, $key-pattern, $keys-pattern...) {
  $result: ();
  @each $key in list.join(($key-pattern,), $keys-pattern, comma) {
    @each $k in map.keys(pick-pattern.pattern($map, $key...)) {
      @if not list.index($result, $k) {
        $result: list.append($result, $k, comma);
      }
    }
  }
  @return list.length($result) > 0
    and $result
    or null;
}

// Examples.
// $-map: (
//   key: (
//     key1: 1
//   ),
//   list1: (),
//   list2: (),
//   (list1, list2): (),
//   list1 list2: (),
//   a b c d e f: value,
//   a: (
//     b: (
//       c: (
//         d: e,
//       ),
//     ),
//   ),
//   any: true,
//   all: false,
//   separator: auto,
//   bracketed: false,
//   method: join,
//   null: false,
//   false: null,
//   'false': null
// );

// key
// @debug pattern($-map, 'key'); // null

// '?=' find keys with `list.index()`
// @debug pattern($-map, '?=list1'); // list1, (list1, list2), list1 list2

// '^'
// @debug pattern($-map, '^sep'); // separator
// @debug pattern($-map, '^sep', '^sep'); // (separator,)
// @debug pattern($-map, 'sep^'); // (separator,)
// @debug pattern($-map, '^rac'); // ()

// '$'
// @debug pattern($-map, '$tor'); // (separator,)
// @debug pattern($-map, '$ara'); // ()
// @debug pattern($-map, 'tor$'); // (separator,)

// '~='
// @debug pattern($-map, '~=ara'); // (separator,)
// @debug pattern($-map, 'ara~='); // (separator,)

// '*'
// @debug pattern($-map, '*key'); // (key,)
// @debug pattern($-map, '*ara'); // (separator,)
// @debug pattern($-map, '*list'); // list1, list2
// @debug pattern($-map, '*key', '*list'); // key, list1, list2

// 'value:' 
// @debug pattern($-map, 'value:bool'); // any, all, bracketed, null
// @debug pattern($-map, 'value:list'); // list1, list2, (list1, list2), list1 list2

// 'key:'
// @debug pattern($-map, 'key:bool'); // (false,)
// @debug pattern($-map, 'key:string'); // key, list1, list2, a, any, all, separator, bracketed, method, "false"
